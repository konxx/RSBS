# RS-BS: åŸºäºå¥–åŠ±-æ•æ„Ÿåº¦çš„éšç§é¢„ç®—è°ƒåº¦æ–¹æ³•

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-ee4c2c.svg)](https://pytorch.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

æœ¬ä»“åº“å®ç°äº†ç”¨äº**å·®åˆ†éšç§ï¼ˆDPï¼‰è”é‚¦å­¦ä¹ **çš„ **RS-BSï¼ˆReward-Sensitivity Budget Schedulingï¼‰é¢„ç®—è°ƒåº¦ç®—æ³•**ã€‚è¯¥æ–¹æ³•æ ¹æ®å®¢æˆ·ç«¯çš„å¥–åŠ±ä¿¡å·å’Œæ•æ„Ÿåº¦åŠ¨æ€åˆ†é…éšç§é¢„ç®—ï¼Œåœ¨ä¿æŠ¤ç”¨æˆ·éšç§çš„åŒæ—¶æœ€å¤§åŒ–æ¨¡å‹æ•ˆç”¨ï¼Œå¹¶ç¡®ä¿å…¬å¹³æ€§ã€‚

---

## ğŸ“‹ ç›®å½•

- [ç ”ç©¶èƒŒæ™¯](#ç ”ç©¶èƒŒæ™¯)
- [ç®—æ³•åŸç†](#ç®—æ³•åŸç†)
- [ä¸»è¦ç‰¹æ€§](#ä¸»è¦ç‰¹æ€§)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®éªŒè¯´æ˜](#å®éªŒè¯´æ˜)
- [å¯è§†åŒ–](#å¯è§†åŒ–)
- [é…ç½®è¯¦è§£](#é…ç½®è¯¦è§£)
- [è¾“å‡ºæ–‡ä»¶](#è¾“å‡ºæ–‡ä»¶)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)
- [å¼•ç”¨](#å¼•ç”¨)

---

## ç ”ç©¶èƒŒæ™¯

### é—®é¢˜æè¿°

åœ¨å·®åˆ†éšç§è”é‚¦å­¦ä¹ ä¸­ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯çš„éšç§é¢„ç®— Îµ æ§åˆ¶ç€å™ªå£°æ³¨å…¥é‡ï¼š
- **Îµ è¾ƒå¤§** â†’ å™ªå£°å°ï¼Œæ¨¡å‹æ•ˆç”¨é«˜ï¼Œä½†éšç§ä¿æŠ¤å¼±
- **Îµ è¾ƒå°** â†’ å™ªå£°å¤§ï¼Œéšç§ä¿æŠ¤å¼ºï¼Œä½†æ¨¡å‹æ•ˆç”¨ä½

ä¼ ç»Ÿæ–¹æ³•ä¸ºæ‰€æœ‰å®¢æˆ·ç«¯åˆ†é…**ç›¸åŒçš„å›ºå®šé¢„ç®—**ï¼Œå¿½ç•¥äº†å®¢æˆ·ç«¯é—´çš„å¼‚è´¨æ€§ï¼š
- **æ•°æ®è´¨é‡å·®å¼‚**ï¼šéƒ¨åˆ†å®¢æˆ·ç«¯æ•°æ®é‡å¤§ã€è´¨é‡é«˜ï¼Œè´¡çŒ®æ›´å¤š
- **éšç§æ•æ„Ÿåº¦å·®å¼‚**ï¼šéƒ¨åˆ†å®¢æˆ·ç«¯å¯¹éšç§ä¿æŠ¤è¦æ±‚æ›´é«˜
- **èµ„æºèƒ½åŠ›å·®å¼‚**ï¼šè®¡ç®—å’Œé€šä¿¡èƒ½åŠ›ä¸åŒ

### æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ

RS-BS ç®—æ³•é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°**ä¸ªæ€§åŒ–é¢„ç®—åˆ†é…**ï¼š

1. **å¥–åŠ±ä¿¡å·**ï¼šåŸºäºå®¢æˆ·ç«¯æ¢¯åº¦å¯¹æ¨¡å‹æ›´æ–°çš„è´¡çŒ®åº¦ï¼ŒåŠ¨æ€è°ƒæ•´é¢„ç®—
2. **æ•æ„Ÿåº¦æ„ŸçŸ¥**ï¼šå¯¹é«˜æ•æ„Ÿåº¦å®¢æˆ·ç«¯åˆ†é…è¾ƒå°é¢„ç®—ï¼Œä¿æŠ¤å…¶éšç§
3. **é¢„ç®—æ± çº¦æŸ**ï¼šä½¿ç”¨æŠ•å½±æœºåˆ¶ç¡®ä¿å…¨å±€é¢„ç®—çº¦æŸï¼Œä¿è¯å…¬å¹³æ€§
4. **ä¸¤é˜¶æ®µè®­ç»ƒ**ï¼šå°†é¢„ç®—æ‹†åˆ†ä¸ºä¸Šä¼ å’Œæœ¬åœ°å¾®è°ƒä¸¤ä¸ªé˜¶æ®µ

---

## ç®—æ³•åŸç†

### æ ¸å¿ƒå…¬å¼

**é¢„ç®—æ›´æ–°è§„åˆ™**ï¼ˆè®ºæ–‡å…¬å¼ 3-7ï¼‰ï¼š
```
ÎµÌƒ_k^{t+1} = Îµ_k^t + Î³ Â· (r_k^t - Î² Â· s_k)
```

å…¶ä¸­ï¼š
- `Îµ_k^t`ï¼šå®¢æˆ·ç«¯ k åœ¨ç¬¬ t è½®çš„é¢„ç®—
- `Î³`ï¼šæ­¥é•¿ï¼ˆæ§åˆ¶é¢„ç®—å˜åŒ–å¹…åº¦ï¼‰
- `r_k^t`ï¼šå¥–åŠ±ä¿¡å·ï¼ˆåŸºäºæ¢¯åº¦è´¡çŒ®å’ŒæŸå¤±ä¸‹é™ï¼‰
- `Î²`ï¼šæ•æ„Ÿåº¦æƒé‡
- `s_k`ï¼šå®¢æˆ·ç«¯æ•æ„Ÿåº¦

**å¥–åŠ±ä¿¡å·è®¡ç®—**ï¼ˆè®ºæ–‡å…¬å¼ 3-4ï¼‰ï¼š
```
r_k^t = Î»_â„“ Â· Î”â„“_k^t + (1 - Î»_â„“) Â· Ï_k^t - Î»_c Â· c_k
```

å…¶ä¸­ï¼š
- `Î”â„“_k^t`ï¼šæŸå¤±ä»£ç†ï¼ˆåŠ å™ªçš„æŸå¤±ä¸‹é™é‡ï¼‰
- `Ï_k^t`ï¼šä¸€è‡´æ€§ä¿¡å·ï¼ˆæ¢¯åº¦ä¸å…¨å±€æ–¹å‘çš„ç›¸ä¼¼åº¦ï¼‰
- `c_k`ï¼šèµ„æºæˆæœ¬ï¼ˆè®¡ç®—å’Œé€šä¿¡å¼€é”€ï¼‰

**é¢„ç®—æ± æŠ•å½±**ï¼ˆè®ºæ–‡ç®—æ³• 3-1 æ­¥éª¤ 5ï¼‰ï¼š
```
Îµ_k^{t+1} = Îµ_min + (R / Î£_k u_k) Â· u_k
```

ç¡®ä¿ `Î£_k Îµ_k â‰¤ B_total` ä¸” `Îµ_min â‰¤ Îµ_k â‰¤ Îµ_max`

**ä¸¤é˜¶æ®µæ‹†åˆ†**ï¼ˆè®ºæ–‡å…¬å¼ 3-12ï¼‰ï¼š
```
Î·_k^{t+1} = clip(Î·_0 + Î·_1 Â· ÏÌ„_k^t - Î·_2 Â· s_k, 0, 1)
Îµ_k^{up} = Î·_k Â· Îµ_k^{total}
Îµ_k^{ft} = (1 - Î·_k) Â· Îµ_k^{total}
```

---

## ä¸»è¦ç‰¹æ€§

### ğŸ¯ é¢„ç®—è°ƒåº¦ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ | ç‰¹ç‚¹ |
|------|------|------|
| `fixed` | å›ºå®šé¢„ç®— | æ‰€æœ‰å®¢æˆ·ç«¯åˆ†é…ç›¸åŒ Îµ |
| `linear_decay` | çº¿æ€§è¡°å‡ | Îµ éšè®­ç»ƒè½®æ¬¡çº¿æ€§ä¸‹é™ |
| `heuristic` | å¯å‘å¼ | åŸºäºæ•æ„Ÿåº¦çš„ç®€å•è§„åˆ™ |
| `rsbs` | **æœ¬æ–¹æ³•** | åŸºäºå¥–åŠ±-æ•æ„Ÿåº¦çš„åŠ¨æ€è°ƒåº¦ |

### ğŸ” å·®åˆ†éšç§æœºåˆ¶

- **DP-SGD**ï¼šå¯¹æ¢¯åº¦è¿›è¡Œè£å‰ªå’ŒåŠ å™ª
- **æŸå¤±ä»£ç†é€šé“**ï¼šä½¿ç”¨ç‹¬ç«‹éšç§é¢„ç®—çš„åŠ å™ªæŸå¤±æŠ¥å‘Š
- **è‡ªé€‚åº” RDP è®°è´¦**ï¼šä½¿ç”¨ RÃ©nyi DP è¿›è¡Œç´§è‡´éšç§ç»„åˆ

### ğŸ“Š å®éªŒæ”¯æŒ

- **Non-IID æ•°æ®åˆ†åŒº**ï¼šåŸºäº Dirichlet åˆ†å¸ƒï¼ˆÎ± å¯è°ƒï¼‰
- **å®¢æˆ·ç«¯å¼‚è´¨æ€§å»ºæ¨¡**ï¼šæ•æ„Ÿåº¦ç­‰çº§ã€èµ„æºèƒ½åŠ›å·®å¼‚
- **å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ**ï¼šCSV/JSON æ ¼å¼ï¼Œæ”¯æŒåç»­åˆ†æ

---

## ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- PyTorch 2.0+ï¼ˆæ”¯æŒ CUDA å¯é€‰ï¼‰
- 8GB+ RAMï¼ˆå»ºè®® 16GBï¼‰

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/RSBS.git
cd RSBS

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ– .\venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### ä¾èµ–åˆ—è¡¨

```
torch>=2.0.0
torchvision>=0.15.0
numpy>=1.21.0
pandas>=1.3.0
matplotlib>=3.4.0
pyyaml>=6.0
```

---

## å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œå¯¹æ¯”å®éªŒ

```bash
# MNIST æ•°æ®é›†ï¼ˆçº¦ 10-15 åˆ†é’Ÿï¼‰
python -m experiments.run_comparison --dataset mnist --out runs/mnist_comp

# CIFAR-10 æ•°æ®é›†ï¼ˆçº¦ 30-45 åˆ†é’Ÿï¼‰
python -m experiments.run_comparison --dataset cifar10 --out runs/cifar_comp
```

### 2. ç”Ÿæˆè®ºæ–‡å›¾ç‰‡

```bash
python -m visualization.plot_paper_figures \
    --comp_dir runs/mnist_comp \
    --dyn_dir runs/mnist_dyn/mnist/rsbs_track \
    --abl_dir runs/mnist_abl \
    --dataset mnist \
    --out_dir figures/
```

### 3. æŸ¥çœ‹ç»“æœ

ç”Ÿæˆçš„å›¾ç‰‡ä¿å­˜åœ¨ `figures/` ç›®å½•ï¼š
- `fig_comparison_accuracy.png` â€” å‡†ç¡®ç‡å¯¹æ¯”
- `fig_comparison_fairness.png` â€” å…¬å¹³æ€§å¯¹æ¯”
- `fig_pool_usage.png` â€” é¢„ç®—ä½¿ç”¨ç‡
- ç­‰ç­‰...

---

## å®éªŒè¯´æ˜

### 1. ç­–ç•¥å¯¹æ¯”å®éªŒ (`run_comparison`)

æ¯”è¾ƒå››ç§é¢„ç®—è°ƒåº¦ç­–ç•¥åœ¨ç›¸åŒæ¡ä»¶ä¸‹çš„æ€§èƒ½ï¼š

```bash
python -m experiments.run_comparison \
    --dataset mnist \
    --out runs/mnist_comp \
    --rounds 100 \
    --clients_per_round 10
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--dataset` | `mnist` | æ•°æ®é›†ï¼š`mnist` æˆ– `cifar10` |
| `--out` | å¿…å¡« | è¾“å‡ºç›®å½• |
| `--rounds` | 100 | è®­ç»ƒè½®æ•° |
| `--clients_per_round` | 10 | æ¯è½®é‡‡æ ·å®¢æˆ·ç«¯æ•° |
| `--model` | è‡ªåŠ¨ | æ¨¡å‹ï¼š`lenet`ï¼ˆMNISTï¼‰æˆ– `simple_cnn`ï¼ˆCIFAR-10ï¼‰ |

**è¾“å‡ºç»“æ„ï¼š**
```
runs/mnist_comp/
â””â”€â”€ mnist/
    â”œâ”€â”€ fixed/
    â”‚   â”œâ”€â”€ metrics_round.csv
    â”‚   â”œâ”€â”€ clients_round.csv
    â”‚   â””â”€â”€ meta.json
    â”œâ”€â”€ linear_decay/
    â”œâ”€â”€ heuristic/
    â””â”€â”€ rsbs/
```

### 2. åŠ¨æ€è·Ÿè¸ªå®éªŒ (`run_dynamics`)

æ·±å…¥è§‚å¯Ÿ RS-BS ç­–ç•¥ä¸‹å››ä¸ªå…¸å‹å®¢æˆ·ç«¯çš„è¡Œä¸ºï¼š

```bash
python -m experiments.run_dynamics --dataset mnist --out runs/mnist_dyn
```

**è·Ÿè¸ªçš„å®¢æˆ·ç«¯ç±»å‹ï¼š**

| ç±»å‹ | æ•æ„Ÿåº¦ | å¥–åŠ± | é¢„æœŸè¡Œä¸º |
|------|--------|------|----------|
| Low-S High-R | ä½ | é«˜ | é¢„ç®—æŒç»­å¢åŠ  |
| Low-S Low-R | ä½ | ä½ | é¢„ç®—ä¿æŒç¨³å®š |
| High-S High-R | é«˜ | é«˜ | é¢„ç®—å—é™äºæ•æ„Ÿåº¦ |
| High-S Low-R | é«˜ | ä½ | é¢„ç®—æŒç»­é™ä½ |

**é¢å¤–è¾“å‡ºï¼š**
- `tracked_clients.json` â€” è·Ÿè¸ªå®¢æˆ·ç«¯çš„å…ƒä¿¡æ¯
- å¯ç”¨äºç»˜åˆ¶é¢„ç®—æ¼”åŒ–æ›²çº¿

### 3. æ¶ˆèç ”ç©¶ (`run_ablation`)

éªŒè¯ RS-BS å„ç»„ä»¶çš„è´¡çŒ®ï¼š

```bash
python -m experiments.run_ablation --dataset mnist --out runs/mnist_abl
```

**æ¶ˆèå˜ä½“ï¼š**

| å˜ä½“åç§° | ä¿®æ”¹ | ç›®çš„ |
|---------|------|------|
| `rsbs_full` | æ—  | å®Œæ•´æ–¹æ³•ï¼ˆåŸºå‡†ï¼‰ |
| `no_sensitivity_beta0` | Î²=0 | éªŒè¯æ•æ„Ÿåº¦é¡¹çš„ä½œç”¨ |
| `no_cost_lambda0` | Î»_c=0 | éªŒè¯æˆæœ¬é¡¹çš„ä½œç”¨ |
| `no_projection` | ç¦ç”¨æŠ•å½± | éªŒè¯é¢„ç®—æ± çº¦æŸçš„ä½œç”¨ |
| `no_two_stage` | ç¦ç”¨ä¸¤é˜¶æ®µ | éªŒè¯ä¸¤é˜¶æ®µè®­ç»ƒçš„ä½œç”¨ |

---

## å¯è§†åŒ–

### ç»Ÿä¸€ç»˜å›¾è„šæœ¬

`visualization/plot_paper_figures.py` ç”Ÿæˆè®ºæ–‡æ‰€éœ€çš„ **6 å¼ å…³é”®å›¾ç‰‡**ï¼š

```bash
python -m visualization.plot_paper_figures \
    --comp_dir runs/mnist_comp \
    --dyn_dir runs/mnist_dyn/mnist/rsbs_track \
    --abl_dir runs/mnist_abl \
    --dataset mnist \
    --out_dir figures/
```

### è¾“å‡ºå›¾ç‰‡è¯´æ˜

| æ–‡ä»¶å | è¯´æ˜ | æ•°æ®æ¥æº |
|--------|------|----------|
| `fig_noniid_heterogeneity.png` | Non-IID æ•°æ®åˆ†å¸ƒåŠå®¢æˆ·ç«¯å¼‚æ„æ€§ç¤ºæ„ | é…ç½®æ–‡ä»¶æ¨¡æ‹Ÿ |
| `fig_comparison_accuracy.png` | å…¨å±€å‡†ç¡®ç‡å¯¹æ¯”æ›²çº¿ (Acc vs Round) | å¯¹æ¯”å®éªŒ |
| `fig_comparison_fairness.png` | å…¬å¹³æ€§å¯¹æ¯”æ›²çº¿ (Fairness Var vs Round) | å¯¹æ¯”å®éªŒ |
| `fig_pool_usage.png` | é¢„ç®—æ± ä½¿ç”¨ç‡æ›²çº¿ | å¯¹æ¯”å®éªŒ |
| `fig_client_budget_evolution.png` | ä»£è¡¨å®¢æˆ·ç«¯é¢„ç®—æ¼”åŒ–æ›²çº¿ | åŠ¨æ€è·Ÿè¸ªå®éªŒ |
| `fig_ablation_comparison.png` | æ¶ˆèå¯¹æ¯”æŸ±çŠ¶å›¾ï¼ˆæ€§èƒ½+å…¬å¹³æ€§+ä»£ä»·ï¼‰ | æ¶ˆèå®éªŒ |

### å‘½ä»¤å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--comp_dir` | `runs/mnist_comp` | å¯¹æ¯”å®éªŒç›®å½• |
| `--dyn_dir` | `runs/mnist_dyn/mnist/rsbs_track` | åŠ¨æ€è·Ÿè¸ªå®éªŒç›®å½• |
| `--abl_dir` | `runs/mnist_abl` | æ¶ˆèå®éªŒç›®å½• |
| `--config_dir` | `config` | é…ç½®æ–‡ä»¶ç›®å½• |
| `--dataset` | `mnist` | æ•°æ®é›†å­ç›®å½•å |
| `--out_dir` | `figures` | è¾“å‡ºç›®å½• |
| `--tail_k` | `5` | å°¾éƒ¨ K è½®ç”¨äºæ”¶æ•›æŒ‡æ ‡ |
| `--ignore_round0` | `True` | å¿½ç•¥ç¬¬ 0 è½® |

> **æ³¨æ„**ï¼šæ—§ç‰ˆå¯è§†åŒ–è„šæœ¬å·²å½’æ¡£è‡³ `visualization/_archive/`

---

## é…ç½®è¯¦è§£

æ‰€æœ‰é…ç½®æ–‡ä»¶ä½äº `config/` ç›®å½•ã€‚

### `base_config.yaml` â€” åŸºç¡€é…ç½®

```yaml
seed: 42                    # éšæœºç§å­

dataset:
  name: "mnist"             # "mnist" æˆ– "cifar10"
  root: "./data/download"   # æ•°æ®é›†ä¸‹è½½ç›®å½•
  num_classes: 10

federated:
  num_clients: 50           # æ€»å®¢æˆ·ç«¯æ•°
  clients_per_round: 10     # æ¯è½®é‡‡æ ·æ•°
  rounds: 100               # è®­ç»ƒè½®æ•°
  local_epochs_up: 1        # ä¸Šä¼ é˜¶æ®µæœ¬åœ°è½®æ•°
  local_epochs_ft: 1        # å¾®è°ƒé˜¶æ®µæœ¬åœ°è½®æ•°
  batch_size: 128
  lr: 0.03                  # å­¦ä¹ ç‡
  momentum: 0.9

model:
  name: "lenet"             # MNIST ç”¨ "lenet", CIFAR-10 ç”¨ "simple_cnn"

device:
  use_cuda: true            # æ˜¯å¦ä½¿ç”¨ GPU
```

### `hetero_config.yaml` â€” å¼‚è´¨æ€§é…ç½®

```yaml
non_iid:
  dirichlet_alpha: 1.0      # Dirichlet å‚æ•°ï¼Œè¶Šå°è¶Š Non-IID
                            # æ¨èï¼š0.1ï¼ˆæç«¯ï¼‰ã€0.3ï¼ˆä¸­ç­‰ï¼‰ã€1.0ï¼ˆæ¸©å’Œï¼‰

sensitivity:
  levels: [0.2, 0.5, 0.8]   # æ•æ„Ÿåº¦ç­‰çº§
  ratio: [5, 3, 2]          # å„ç­‰çº§å®¢æˆ·ç«¯æ¯”ä¾‹ï¼ˆ5:3:2ï¼‰

resources:
  nu_range: [0.6, 1.4]      # è®¡ç®—èƒ½åŠ›èŒƒå›´
  omega_range: [0.6, 1.4]   # å¸¦å®½èƒ½åŠ›èŒƒå›´
```

### `privacy_config.yaml` â€” éšç§ä¸ RS-BS é…ç½®

```yaml
dp:
  delta: 1.0e-4             # DP çš„ Î´ å‚æ•°
  clip_norm: 1.0            # æ¢¯åº¦è£å‰ªèŒƒæ•°

budget:
  B_total: 200.0            # æ¯è½®å…¨å±€é¢„ç®—æ± 
  epsilon_min: 1.0          # å•å®¢æˆ·ç«¯æœ€å° Îµ
  epsilon_max: 12.0         # å•å®¢æˆ·ç«¯æœ€å¤§ Îµ

rsbs:
  # é¢„ç®—æ›´æ–°å‚æ•°ï¼ˆå…¬å¼ 3-7ï¼‰
  gamma: 0.2                # æ­¥é•¿
  beta: 0.3                 # æ•æ„Ÿåº¦æƒé‡

  # å¥–åŠ±ä¿¡å·å‚æ•°ï¼ˆå…¬å¼ 3-4ï¼‰
  alpha: 0.8                # EMA å¹³æ»‘ç³»æ•°
  lambda_l: 0.5             # æŸå¤±ä»£ç†æƒé‡
  lambda_c: 0.2             # èµ„æºæˆæœ¬æƒ©ç½š

  # ä¸¤é˜¶æ®µæ‹†åˆ†å‚æ•°ï¼ˆå…¬å¼ 3-12ï¼‰
  eta0: 0.7                 # åŸºç¡€æ‹†åˆ†ç³»æ•°
  eta1: 0.2                 # ä¸€è‡´æ€§ä¿¡å·æƒé‡
  eta2: 0.1                 # æ•æ„Ÿåº¦æŠ‘åˆ¶æƒé‡
  eta_min: 0.0              # æ‹†åˆ†ç³»æ•°ä¸‹ç•Œ
  eta_max: 1.0              # æ‹†åˆ†ç³»æ•°ä¸Šç•Œ

  # æŸå¤±ä»£ç†æœºåˆ¶
  loss_proxy:
    enabled: true
    C_ell: 1.0              # æˆªæ–­é˜ˆå€¼
    epsilon_ell: 0.1        # æŸå¤±é€šé“éšç§é¢„ç®—
    delta_ell: 1.0e-5

  # ä¿¡å·å½’ä¸€åŒ–
  norm_epsilon: 1e-8        # æ•°å€¼ç¨³å®šé¡¹
  norm_clip_low: 0.01       # å½’ä¸€åŒ–ä¸‹ç•Œ
  norm_clip_high: 0.99      # å½’ä¸€åŒ–ä¸Šç•Œ

  temperature: 0.01         # æ¸©åº¦å‚æ•°ï¼ˆä½æ¸©=ç¡®å®šæ€§ï¼‰

accounting:
  method: "adaptive_rdp"    # RDP è®°è´¦æ–¹æ³•
  max_alpha: 64.0           # RDP Î± ä¸Šç•Œ
  steps_per_round: 10       # æ¯è½®æœ¬åœ°æ­¥æ•°
```

### RS-BS å‚æ•°è°ƒä¼˜å»ºè®®

| å‚æ•° | è°ƒå¤§æ•ˆæœ | è°ƒå°æ•ˆæœ |
|------|----------|----------|
| `gamma` | é¢„ç®—å˜åŒ–æ›´å‰§çƒˆ | é¢„ç®—å˜åŒ–æ›´å¹³ç¨³ |
| `beta` | æ›´é‡è§†éšç§ä¿æŠ¤ | æ›´é‡è§†æ¨¡å‹æ•ˆç”¨ |
| `lambda_l` | æ›´é‡è§†æŸå¤±ä¸‹é™ | æ›´é‡è§†æ¢¯åº¦ä¸€è‡´æ€§ |
| `lambda_c` | æ›´æƒ©ç½šèµ„æºæ¶ˆè€— | å¿½ç•¥èµ„æºå·®å¼‚ |

---

## è¾“å‡ºæ–‡ä»¶

æ¯æ¬¡å®éªŒè¿è¡Œç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### `metrics_round.csv` â€” æ¯è½®å…¨å±€æŒ‡æ ‡

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `round` | int | è®­ç»ƒè½®æ¬¡ |
| `strategy` | str | ç­–ç•¥åç§° |
| `global_acc` | float | å…¨å±€æµ‹è¯•å‡†ç¡®ç‡ |
| `global_loss` | float | å…¨å±€æµ‹è¯•æŸå¤± |
| `budget_used` | float | æœ¬è½®å·²ç”¨é¢„ç®—æ€»é‡ |
| `pool_usage` | float | é¢„ç®—æ± ä½¿ç”¨ç‡ (budget_used / B_total) |
| `num_eps_min` | int | è§¦åŠä¸‹ç•Œçš„å®¢æˆ·ç«¯æ•° |
| `num_eps_max` | int | è§¦åŠä¸Šç•Œçš„å®¢æˆ·ç«¯æ•° |
| `projection_triggered` | bool | æœ¬è½®æ˜¯å¦è§¦å‘æŠ•å½± |
| `fairness_var` | float | å¥–åŠ±ä¿¡å·æ–¹å·®ï¼ˆå…¬å¹³æ€§æŒ‡æ ‡ï¼‰ |
| `client_acc_var` | float | å®¢æˆ·ç«¯å‡†ç¡®ç‡æ–¹å·® |
| `worst_client_acc` | float | æœ€å·®å®¢æˆ·ç«¯å‡†ç¡®ç‡ |

### `clients_round.csv` â€” æ¯è½®å®¢æˆ·ç«¯æŒ‡æ ‡

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `round` | int | è®­ç»ƒè½®æ¬¡ |
| `cid` | int | å®¢æˆ·ç«¯ ID |
| `epsilon_total` | float | åˆ†é…çš„æ€»é¢„ç®— |
| `epsilon_up` | float | ä¸Šä¼ é˜¶æ®µé¢„ç®— |
| `epsilon_ft` | float | å¾®è°ƒé˜¶æ®µé¢„ç®— |
| `eta` | float | ä¸¤é˜¶æ®µæ‹†åˆ†ç³»æ•° |
| `raw_reward` | float | åŸå§‹å¥–åŠ±ä¿¡å· |
| `reward_ema` | float | å¹³æ»‘åçš„å¥–åŠ±ä¿¡å· |
| `sensitivity` | float | å®¢æˆ·ç«¯æ•æ„Ÿåº¦ |
| `cost` | float | èµ„æºæˆæœ¬ |
| `nu` | float | è®¡ç®—èƒ½åŠ›ç³»æ•° |
| `omega` | float | å¸¦å®½èƒ½åŠ›ç³»æ•° |
| `tracked` | bool | æ˜¯å¦ä¸ºè·Ÿè¸ªå®¢æˆ·ç«¯ |

### `meta.json` â€” è¿è¡Œé…ç½®å¿«ç…§

åŒ…å«æœ¬æ¬¡è¿è¡Œçš„æ‰€æœ‰é…ç½®å‚æ•°ï¼Œä¾¿äºå¤ç°ã€‚

### `tracked_clients.json`ï¼ˆä»…åŠ¨æ€è·Ÿè¸ªå®éªŒï¼‰

```json
{
  "dataset": "mnist",
  "clients": {
    "47": {"cid": 47, "sensitivity": 0.2, "role": "low_sens_high_reward"},
    "19": {"cid": 19, "sensitivity": 0.2, "role": "low_sens_low_reward"},
    "3": {"cid": 3, "sensitivity": 0.8, "role": "high_sens_high_reward"},
    "28": {"cid": 28, "sensitivity": 0.8, "role": "high_sens_low_reward"}
  },
  "track_list": [47, 19, 3, 28]
}
```

---

## é¡¹ç›®ç»“æ„

```
RSBS/
â”œâ”€â”€ config/                     # YAML é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ base_config.yaml        # åŸºç¡€é…ç½®ï¼ˆæ•°æ®é›†ã€è®­ç»ƒã€è®¾å¤‡ï¼‰
â”‚   â”œâ”€â”€ hetero_config.yaml      # å¼‚è´¨æ€§é…ç½®ï¼ˆNon-IIDã€æ•æ„Ÿåº¦ï¼‰
â”‚   â””â”€â”€ privacy_config.yaml     # éšç§é…ç½®ï¼ˆDPã€RS-BS è¶…å‚æ•°ï¼‰
â”‚
â”œâ”€â”€ core/                       # æ ¸å¿ƒç®—æ³•å®ç°
â”‚   â”œâ”€â”€ server.py               # è”é‚¦æœåŠ¡å™¨ï¼ˆé¢„ç®—è°ƒåº¦ã€èšåˆï¼‰
â”‚   â”œâ”€â”€ client.py               # è”é‚¦å®¢æˆ·ç«¯ï¼ˆæœ¬åœ°è®­ç»ƒã€DP-SGDï¼‰
â”‚   â””â”€â”€ dp_mechanisms.py        # DP æœºåˆ¶ï¼ˆè£å‰ªã€åŠ å™ªã€è®°è´¦ï¼‰
â”‚
â”œâ”€â”€ data/                       # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ datasets.py             # æ•°æ®é›†åŠ è½½å™¨
â”‚   â”œâ”€â”€ partitioner.py          # Non-IID åˆ†åŒºé€»è¾‘
â”‚   â””â”€â”€ download/               # æ•°æ®é›†ä¸‹è½½ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚
â”œâ”€â”€ experiments/                # å®éªŒè„šæœ¬
â”‚   â”œâ”€â”€ run_comparison.py       # ç­–ç•¥å¯¹æ¯”å®éªŒ
â”‚   â”œâ”€â”€ run_dynamics.py         # åŠ¨æ€è·Ÿè¸ªå®éªŒ
â”‚   â”œâ”€â”€ run_ablation.py         # æ¶ˆèç ”ç©¶
â”‚   â””â”€â”€ common.py               # å…±äº«å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ models/                     # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ lenet.py                # LeNet (MNIST)
â”‚   â””â”€â”€ simple_cnn.py           # SimpleCNN (CIFAR-10)
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ logger.py               # å®éªŒæ—¥å¿—è®°å½•å™¨
â”‚   â””â”€â”€ metrics.py              # æŒ‡æ ‡è®¡ç®—å·¥å…·
â”‚
â”œâ”€â”€ visualization/              # å¯è§†åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ plot_paper_figures.py   # è®ºæ–‡å›¾ç‰‡ç”Ÿæˆï¼ˆä¸»è„šæœ¬ï¼‰
â”‚   â””â”€â”€ _archive/               # å½’æ¡£çš„æ—§ç‰ˆè„šæœ¬
â”‚
â”œâ”€â”€ figures/                    # ç”Ÿæˆçš„è®ºæ–‡å›¾ç‰‡
â”œâ”€â”€ runs/                       # å®éªŒè¾“å‡ºï¼ˆå¯å®‰å…¨åˆ é™¤ï¼‰
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥è§„åˆ™
â””â”€â”€ README.md                   # æœ¬æ–‡æ¡£
```

---

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„é¢„ç®—è°ƒåº¦ç­–ç•¥

1. **å®ç°ç­–ç•¥é€»è¾‘** â€” åœ¨ `core/server.py` ä¸­æ·»åŠ  `_alloc_<strategy_name>` æ–¹æ³•ï¼š

```python
def _alloc_my_strategy(self, selected: List[int]) -> Dict[int, float]:
    """è‡ªå®šä¹‰é¢„ç®—åˆ†é…ç­–ç•¥"""
    eps_alloc = {}
    for cid in selected:
        # å®ç°æ‚¨çš„åˆ†é…é€»è¾‘
        eps_alloc[cid] = ...
    return eps_alloc
```

2. **æ³¨å†Œç­–ç•¥** â€” åœ¨ `experiments/run_comparison.py` ä¸­æ·»åŠ ç­–ç•¥åç§°

3. **æ›´æ–°é…ç½®** â€” å¦‚éœ€æ–°å‚æ•°ï¼Œåœ¨ `privacy_config.yaml` ä¸­æ·»åŠ 

### æ·»åŠ æ–°çš„æ•°æ®é›†

1. **å®ç°æ•°æ®åŠ è½½** â€” åœ¨ `data/datasets.py` ä¸­æ·»åŠ åŠ è½½å‡½æ•°ï¼š

```python
def load_my_dataset(root: str):
    train_set = ...
    test_set = ...
    return train_set, test_set
```

2. **æ·»åŠ å¯¹åº”æ¨¡å‹** â€” åœ¨ `models/` ç›®å½•åˆ›å»ºæ¨¡å‹æ–‡ä»¶ï¼Œå¹¶åœ¨ `models/__init__.py` ä¸­æ³¨å†Œ

3. **æ›´æ–°é…ç½®** â€” åœ¨ `base_config.yaml` ä¸­æ·»åŠ æ•°æ®é›†é€‰é¡¹

---

## å¼•ç”¨

å¦‚æœæ‚¨ä½¿ç”¨äº†æœ¬ä»£ç ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@article{rsbs2024,
  title={RS-BS: Reward-Sensitivity Based Privacy Budget Scheduling for Differential Privacy Federated Learning},
  author={Your Name},
  journal={Your Journal},
  year={2024}
}
```

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ Issue
- å‘é€é‚®ä»¶è‡³ your-email@example.com
